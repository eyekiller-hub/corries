{% schema %}
  {
    "name": "Recently viewed products",
    "settings": [
      {
        "type": "checkbox",
        "id": "enable",
        "label": "Enable?",
        "default": true
      },
      {
        "type": "number",
        "id": "limit",
        "label": "Limit",
        "default": 4
      }
    ]
  }
{% endschema %}

{% assign enable = section.settings.enable %}

{% assign limit = section.settings.limit | default: 4 %}

{% include 'attribute-product-upsells' %}

{% if enable %}
  {% capture product_card_grid_item_class_name_template %}
    {% include 'product-card-grid-item-class-name-template' %}
  {% endcapture %}

  {% if template == 'search.recently-viewed-products' %}
    {% paginate search.results by 1000 %}
      <div class="padding-bottom--up-2 large--padding-bottom--up-4">
        <div class="container-default">
          <h2 class="text-center margin-bottom--0">
            {{ 'products.product.recently_viewed_products_title' | t }}
          </h3>

          <div class="overflow-hidden">
            <div class="grid--up-1 margin-bottom-negative--up-1">
              {% for product in search.results %}
                <div class="{{ product_card_grid_item_class_name_template }}">
                  {% include 'product-card' %}
                </div>
              {% endfor %}
            </div>
          </div>
        </h2>
      </div>
    {% endpaginate %}
  {% else %}
    <div data-module-recently-viewed-products='{ "limit": {{ limit | json }} }'></div>
  {% endif %}
{% endif %}
