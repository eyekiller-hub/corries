{%- layout none -%}

{%- paginate collection.products by 100 -%}
  {%- capture json -%}
    {
      "products": [
        {%- for product in collection.products -%}
          {% include 'attribute-product-tag-badge' %}

          {
            "featured_image": {
              "src": {{ product.featured_image | img_url: '600x' | json }},
              "alt": {{ product.featured_image.alt | json }},
              "width": {{ product.featured_image.width | default: 600 | json }},
              "height": {{ product.featured_image.height | default: 600 | json }}
            },
            "handle": {{ product.handle | json }},
            "price": {{ product.price | json }},
            "compare_at_price_min": {{ product.compare_at_price_min | json }},
            "price_varies": {{ product.price_varies | json }},
            "price_min": {{ product.price_min | json }},
            "tags": {{ product.tags | json }},
            "title": {{ product.title | json }},
            "url": {{ product.url | json }},
            "first_available_variant": {{ product.first_available_variant | json }},
            "id": {{ product.id | json }},
            "variants": {{ product.variants | json }},
            "metafields": {
              "card": {
                "copy": {{ product.metafields.card.copy | json }}
              },
              "promo_badge": {
                "copy": {{ product.metafields.promo_badge.copy | json }}
              }
            },
            "custom": {
              {% if product_tag_badge %}
                "product_tag_badge": {
                  "image_url": {{ product_tag_badge_image_url | json }},
                  "image_alt": {{ product_tag_badge_image_alt | json }}
                }
              {% endif %}
            }
          }{%- unless forloop.last -%},{%- endunless -%}
        {%- endfor -%}
      ]
    }
  {%- endcapture -%}

  {%- assign json = json | strip_newlines -%}

  {{ json }}
{%- endpaginate -%}
